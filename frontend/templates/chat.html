{% extends 'base.html' %}
{% block content %}
<script>autoRefresh(5000);</script>
<h2>Chat</h2>
  {% for msg in messages %}
    <div class="chat-bubble {{ msg.role }}">
      <strong>{{ msg.role | capitalize }}{% if msg.agent_name %} ({{ msg.agent_name }}){% endif %}:</strong><br>
      {{ msg.content }}
    </div>
  {% endfor %}

  {% if checkpoints %}
    <h3>Pending Approvals</h3>
    {% for cp in checkpoints if cp.status == 'pending' %}
      <div class="checkpoint-card">
        <strong>{{ cp.title }}</strong>
        <p>{{ cp.description }}</p>
        <pre>{{ cp.content }}</pre>
        <form method="post" action="/checkpoint/{{ cp.id }}/respond">
          <textarea name="response" placeholder="Your feedback..."></textarea><br>
          <button name="approved" value="yes">Approve</button>
          <button name="approved" value="no">Reject</button>
        </form>
      </div>
    {% endfor %}
  {% endif %}

  <form method="get" action="/project/{{ project_id }}/chat/{{ chat_id }}/download">
    <button type="submit">⬇️ Export to Markdown</button>
  </form>
{% endblock %}